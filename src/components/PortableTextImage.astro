---
// ./src/components/PortableTextImage.astro
import { Image, Picture } from "astro:assets";
import { urlForImage } from "../sanitymonicadisneysite/lib/urlForImage";

interface Props {
	type?: "thumbnail" | "in-article";
	class?: string;
	node?: any;
	imageInput?: any;
}

const node = Astro.props.node || Astro.props.imageInput;
const textStyleClass = Astro.props.class;
const imageType = Astro.props.type || "in-article";

const imageURL = urlForImage(node.asset);

/* This section creates a conditional if a width is set. For thumbnails, this setup allows an image to be smaller but Sanity will still call in a higher resolution photo. For in-article, the width and image resolution will be as set in the editor itself. */
let lowestWidth = node.width > 600 && imageType === "thumbnail" ? node.width : 600;

let webpUrl = null;
if (node.width) {
	webpUrl = imageURL.width(lowestWidth).format("webp").url();
} else {
	webpUrl = imageURL.format("webp").url();
}
// end of image resolution and width setup

// This is needed because for the live editor, there is a zero-width-space at the end of the alt text
let getAlignment: "flex-start" | "center" | "flex-end" = node.alignment || "flex-start";

if (node?.alignment?.includes("center")) {
	getAlignment = "center";
} else if (node?.alignment?.includes("end")) {
	getAlignment = "flex-end";
}
// end of note
---

<Picture src={webpUrl} inferSize width={node.width} pictureAttributes={{ style: { justifyContent: getAlignment }, class: "flex" }} class={`responsive__img ${textStyleClass}`} transition:name={"image-" + (node.headTransitionName || node.alt)} alt={node.alt || "Alt image"} title={node.title} formats={["webp"]} />
